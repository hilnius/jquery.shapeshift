(function(){!function(t,e){var s,r,n;return n="shapeshift",r={selector:"*",enableDrag:!0,enableCrossDrop:!0,enableResize:!0,enableTrash:!1,align:"center",colWidth:null,columns:null,minColumns:1,autoHeight:!0,maxHeight:null,minHeight:100,gutterX:10,gutterY:10,paddingX:10,paddingY:10,animated:!0,animateOnInit:!1,animationSpeed:225,animationThreshold:100,dragClone:!1,deleteClone:!0,dragRate:100,dragWhitelist:"*",crossDropWhitelist:"*",cutoffStart:null,cutoffEnd:null,handle:!1,cloneClass:"ss-cloned-child",activeClass:"ss-active-child",draggedClass:"ss-dragged-child",placeholderClass:"ss-placeholder-child",originalContainerClass:"ss-original-container",currentContainerClass:"ss-current-container",previousContainerClass:"ss-previous-container"},s=function(){function s(e,s){this.element=e,this.options=t.extend({},r,s),this.globals={},this.$container=t(e),this.errorCheck()&&this.init()}return s.prototype.errorCheck=function(){var t,e,s,r;return r=this.options,s=!1,e="Shapeshift ERROR:",null===r.colWidth&&(t=this.$container.children(r.selector),0===t.length&&(s=!0,console.error(""+e+" option colWidth must be specified if Shapeshift is initialized with no active children."))),!s},s.prototype.init=function(){return this.createEvents(),this.setGlobals(),this.setIdentifier(),this.setActiveChildren(),this.enableFeatures(),this.gridInit(),this.render(),this.afterInit()},s.prototype.createEvents=function(){var t,e,s=this;return e=this.options,t=this.$container,t.off("ss-arrange").on("ss-arrange",function(t,e){return null==e&&(e=!1),s.render(!1,e)}),t.off("ss-rearrange").on("ss-rearrange",function(){return s.render(!0)}),t.off("ss-setTargetPosition").on("ss-setTargetPosition",function(){return s.setTargetPosition()}),t.off("ss-destroy").on("ss-destroy",function(){return s.destroy()}),t.off("ss-shuffle").on("ss-shuffle",function(){return s.shuffle()})},s.prototype.setGlobals=function(){return this.globals.animated=this.options.animateOnInit,this.globals.dragging=!1},s.prototype.afterInit=function(){return this.globals.animated=this.options.animated},s.prototype.setIdentifier=function(){return this.identifier="shapeshifted_container_"+Math.random().toString(36).substring(7),this.$container.addClass(this.identifier)},s.prototype.enableFeatures=function(){return this.options.enableResize&&this.enableResize(),this.options.enableDrag||this.options.enableCrossDrop?this.enableDragNDrop():void 0},s.prototype.setActiveChildren=function(){var e,s,r,n,i,o,a,l,h,d,u,p;for(a=this.options,e=this.$container.children(a.selector),s=a.activeClass,l=e.length,i=h=0;l>=0?l>h:h>l;i=l>=0?++h:--h)t(e[i]).addClass(s);for(this.setParsedChildren(),n=a.columns,p=[],i=d=0,u=this.parsedChildren.length;u>=0?u>d:d>u;i=u>=0?++d:--d)r=this.parsedChildren[i].colspan,o=a.minColumns,r>n&&r>o?(a.minColumns=r,p.push(console.error("Shapeshift ERROR: There are child elements that have a larger colspan than the minimum columns set through options.\noptions.minColumns has been set to "+r))):p.push(void 0);return p},s.prototype.setParsedChildren=function(){var e,s,r,n,i,o,a;for(s=this.$container.find("."+this.options.activeClass).filter(":visible"),o=s.length,i=[],n=a=0;o>=0?o>a:a>o;n=o>=0?++a:--a)e=t(s[n]),r={i:n,el:e,colspan:parseInt(e.attr("data-ss-colspan"))||1,height:e.outerHeight()},i.push(r);return this.parsedChildren=i},s.prototype.gridInit=function(){var t,e,s,r,n;return r=this.options.gutterX,this.options.colWidth>=1?this.globals.col_width=this.options.colWidth+r:(s=this.parsedChildren[0],e=s.el.outerWidth(),t=s.colspan,n=(e-(t-1)*r)/t,this.globals.col_width=n+r)},s.prototype.render=function(t,e){return null==t&&(t=!1),t&&this.setActiveChildren(),this.setGridColumns(),this.arrange(!1,e)},s.prototype.setGridColumns=function(){var t,e,s,r,n,i,o,a,l,h,d,u,p,c,g;if(i=this.globals,u=this.options,s=i.col_width,a=u.gutterX,p=u.paddingX,h=this.$container.innerWidth()-2*p,d=u.minColumns,n=u.columns||Math.floor((h+a)/s),d&&d>n&&(n=d),i.columns=n,e=this.parsedChildren.length,n>e){for(t=0,l=c=0,g=this.parsedChildren.length;g>=0?g>c:c>g;l=g>=0?++c:--c)r=this.parsedChildren[l].colspan,n>=r+t&&(t+=r);n=t}switch(i.child_offset=p,u.align){case"center":return o=n*s-a,i.child_offset+=(h-o)/2;case"right":return o=n*s-a,i.child_offset+=h-o}},s.prototype.arrange=function(t,e){var s,r,n,i,o,a,l,h,d,u,p,c,g,f,C,v,m,b;for(t&&this.setParsedChildren(),d=this.globals,f=this.options,r=this.$container,a=this.getPositions(),C=this.parsedChildren,m=C.length,n=d.animated&&m<=f.animationThreshold,i=f.animationSpeed,h=f.draggedClass,u=b=0;m>=0?m>b:b>m;u=m>=0?++b:--b)s=C[u].el,o=a[u],p=s.hasClass(h),p&&(v=f.placeholderClass,s=s.siblings("."+v)),n&&!p?s.stop(!0,!1).animate(o,i,function(){}):s.css(o);return e&&(n?setTimeout(function(){return r.trigger("ss-drop-complete")},i):r.trigger("ss-drop-complete")),r.trigger("ss-arranged"),f.autoHeight?(l=d.container_height,c=f.maxHeight,g=f.minHeight,g&&g>l?l=g:c&&l>c&&(l=c),r.height(l)):void 0},s.prototype.getPositions=function(t){var e,s,r,n,i,o,a,l,h,d,u,p,c,g,f,C,v,m,b=this;for(null==t&&(t=!0),i=this.globals,h=this.options,a=h.gutterY,d=h.paddingY,n=h.draggedClass,u=this.parsedChildren,C=u.length,e=[],l=v=0,m=i.columns;m>=0?m>v:v>m;l=m>=0?++v:--v)e.push(d);return g=function(t){var s,r,n,o,l,h,d;if(s=t.col,r=t.colspan,o=t.col*i.col_width+i.child_offset,l=e[s],p[t.i]={left:o,top:l},e[s]+=t.height+a,r>=1){for(d=[],n=h=1;r>=1?r>h:h>r;n=r>=1?++h:--h)d.push(e[s+n]=e[s]);return d}},s=function(t){var s,r,n,i,o,a,l,h,d,u,p,c;for(d=e.length-t.colspan+1,h=e.slice(0).splice(0,d),s=void 0,l=p=0;d>=0?d>p:p>d;l=d>=0?++p:--p){for(r=b.lowestCol(h,l),n=t.colspan,i=e[r],o=!0,u=c=1;n>=1?n>c:c>n;u=n>=1?++c:--c)if(a=e[r+u],a>i){o=!1;break}if(o){s=r;break}}return s},f=[],c=function(){var t,e,r,n,i,o,a,l,h,d;for(i=[],n=o=0,l=f.length;l>=0?l>o:o>l;n=l>=0?++o:--o)r=f[n],r.col=s(r),r.col>=0&&(g(r),i.push(n));for(d=[],e=a=h=i.length-1;a>=0;e=a+=-1)t=i[e],d.push(f.splice(t,1));return d},p=[],(r=function(){var r,i,o;for(o=[],l=i=0;C>=0?C>i:i>C;l=C>=0?++i:--i)r=u[l],t||!r.el.hasClass(n)?(r.col=r.colspan>1?s(r):b.lowestCol(e),void 0===r.col?f.push(r):g(r),o.push(c())):o.push(void 0);return o})(),h.autoHeight&&(o=e[this.highestCol(e)]-a,i.container_height=o+d),p},s.prototype.enableDragNDrop=function(){var s,r,n,i,o,a,l,h,d,u,p,c,g,f,C,v,m,b,y=this;return g=this.options,r=this.$container,o=g.activeClass,c=g.draggedClass,C=g.placeholderClass,f=g.originalContainerClass,l=g.currentContainerClass,v=g.previousContainerClass,h=g.deleteClone,u=g.dragRate,d=g.dragClone,a=g.cloneClass,i=n=s=b=m=null,p=!1,g.enableDrag&&r.children("."+o).filter(g.dragWhitelist).draggable({addClasses:!1,containment:"document",handle:g.handle,zIndex:9999,start:function(e){var r;return y.globals.dragging=!0,i=t(e.target),d&&(s=i.clone(!1,!1).insertBefore(i).addClass(a)),i.addClass(c),r=i.prop("tagName"),n=t("<"+r+" class='"+C+"' style='height: "+i.height()+"px; width: "+i.width()+"px'></"+r+">"),i.parent().addClass(f).addClass(l),b=i.outerHeight()/2,m=i.outerWidth()/2},drag:function(s,r){return p||d&&h&&t("."+l)[0]===t("."+f)[0]||(n.remove().appendTo("."+l),t("."+l).trigger("ss-setTargetPosition"),p=!0,e.setTimeout(function(){return p=!1},u)),r.position.left=s.pageX-i.parent().offset().left-m,r.position.top=s.pageY-i.parent().offset().top-b},stop:function(){var e,r,o;return y.globals.dragging=!1,r=t("."+f),e=t("."+l),o=t("."+v),i.removeClass(c),t("."+C).remove(),d&&(h&&t("."+l)[0]===t("."+f)[0]?(s.remove(),t("."+l).trigger("ss-rearrange")):(s.removeClass(a),r.shapeshift(r.data("plugin_shapeshift").options),e.shapeshift(e.data("plugin_shapeshift").options))),r[0]===e[0]?e.trigger("ss-rearranged",i):(r.trigger("ss-removed",i),e.trigger("ss-added",i)),r.trigger("ss-arrange").removeClass(f),e.trigger("ss-arrange",!0).removeClass(l),o.trigger("ss-arrange").removeClass(v),i=n=null}}),g.enableCrossDrop?r.droppable({accept:g.crossDropWhitelist,tolerance:"intersect",over:function(e){return t("."+v).removeClass(v),t("."+l).removeClass(l).addClass(v),t(e.target).addClass(l)},drop:function(e,s){var r,n,o;return y.options.enableTrash?(n=t("."+f),r=t("."+l),o=t("."+v),i=t(s.helper),r.trigger("ss-trashed",i),i.remove(),n.trigger("ss-rearrange").removeClass(f),r.trigger("ss-rearrange").removeClass(l),o.trigger("ss-arrange").removeClass(v)):void 0}}):void 0},s.prototype.setTargetPosition=function(){var e,s,r,n,i,o,a,l,h,d,u,p,c,g,f,C,v,m,b,y,_,T;if(d=this.options,d.enableTrash)return p=this.options.placeholderClass,t("."+p).remove();if(h=d.draggedClass,e=t("."+h),s=e.parent(),u=this.parsedChildren,i=this.getPositions(!1),b=i.length,f=e.offset().left-s.offset().left+this.globals.col_width/2,C=e.offset().top-s.offset().top+e.height()/2,v=9999999,m=0,b>1){for(a=d.cutoffStart+1||0,o=d.cutoffEnd||b,c=T=a;o>=a?o>T:T>o;c=o>=a?++T:--T)n=i[c],n&&(_=f-n.left,y=C-n.top,_>0&&y>0&&(l=Math.sqrt(y*y+_*_),v>l&&(v=l,m=c,c===b-1&&_>u[c].height/2&&m++)));m<d.customCutoffStart&&(m=d.customCutoffStart),m>b-d.customCutoffEnd&&(m=b-d.customCutoffEnd),m===u.length?(r=u[m-1].el,e.insertAfter(r)):(r=u[m].el,e.insertBefore(r))}else 1===b?(n=i[0],n.left<f?this.$container.append(e):this.$container.prepend(e)):this.$container.append(e);return this.arrange(!0),s[0]!==e.parent()[0]?(g=d.previousContainerClass,1==t("."+g).data("plugin_shapeshift").options.enableCrossDrop?t("."+g).trigger("ss-rearrange"):t("."+g)):void 0},s.prototype.enableResize=function(){var s,r,n,i=this;return s=this.options.animationSpeed,n=!1,r="resize."+this.identifier,t(e).on(r,function(){return n?void 0:(n=!0,setTimeout(function(){return i.render()},s/3),setTimeout(function(){return i.render()},s/3),setTimeout(function(){return n=!1,i.render()},s/3))})},s.prototype.shuffle=function(){var t;return t=function(t,e){var s;return s=function(t){var e,s,r;for(s=void 0,r=void 0,e=t.length;e;)s=parseInt(Math.random()*e),r=t[--e],t[e]=t[s],t[s]=r;return t},t.each(function(){var r;return r=t.find("."+e).filter(":visible"),r.length?t.html(s(r)):this})},this.globals.dragging?void 0:(t(this.$container,this.options.activeClass),this.enableFeatures(),this.$container.trigger("ss-rearrange"))},s.prototype.lowestCol=function(t,e){var s,r,n,i;for(null==e&&(e=0),n=t.length,s=[],r=i=0;n>=0?n>i:i>n;r=n>=0?++i:--i)s.push([t[r],r]);return s.sort(function(t,e){var s;return s=t[0]-e[0],0===s&&(s=t[1]-e[1]),s}),s[e][1]},s.prototype.highestCol=function(s){return t.inArray(Math.max.apply(e,s),s)},s.prototype.destroy=function(){var t,e,s;return e=this.$container,e.off("ss-arrange"),e.off("ss-rearrange"),e.off("ss-setTargetPosition"),e.off("ss-destroy"),s=this.options.activeClass,t=e.find("."+s),this.options.enableDrag&&t.draggable("destroy"),this.options.enableCrossDrop&&e.droppable("destroy"),t.removeClass(s),e.removeClass(this.identifier)},s}(),t.fn[n]=function(r){return this.each(function(){var i,o,a,l;return o=null!=(a=t(this).attr("class"))&&null!=(l=a.match(/shapeshifted_container_\w+/))?l[0]:void 0,o&&(i="resize."+o,t(e).off(i),t(this).removeClass(o)),t.data(this,"plugin_"+n,new s(this,r))})}}(jQuery,window,document)}).call(this);
